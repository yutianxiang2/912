@{
    ViewBag.Title = @Resources.Language.CustomerShip;
    ViewBag.MenuId = "menu2";
    ViewBag.SubMenuIndex = 1;
    Layout = "~/Views/Shared/_ContentLayout.cshtml";
}
@model List<DataModel.Customer>
<div id="main-content">
    <!-- Parent MODAL FORM-->
    <div class="modal fade" id="parent-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div id="model-dlg" class="modal-dialog" style="width:500px">
            <div class="modal-content modal-table">
                @*<div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">拖轮选择</h4>
                    </div>*@
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="box border blue">
                                <div class="box-title">
                                    <h4><i class="fa fa-windows"></i>@Resources.Language.CustomerShip_NewShip</h4>
                                    <div class="tools hidden-xs">
                                        <a href="javascript:;" class="" onclick="$('#parent-modal').modal('hide');">
                                            <i class="fa fa-times"></i>
                                        </a>
                                    </div>
                                </div>
                                <div class="box-body big">
                                    @*<h4 class="form-title">Supported controls</h4>*@
                                    <form class="form-horizontal" role="form">

                                        <div class="row">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">*@Resources.Language.CustomerShip_Name1</label>
                                                    <div class="col-sm-8">
                                                        <input id="_CustomerShip_Name1" class="form-control" placeholder="@Resources.Language.CustomerShip_Name1" onfocus="$(this).parent().removeClass('has-error')" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">@Resources.Language.CustomerShip_Name2</label>
                                                    <div class="col-sm-8">
                                                        <input id="_CustomerShip_Name2" type="text" class="form-control" placeholder="@Resources.Language.CustomerShip_Name2" onfocus="$(this).parent().removeClass('has-error')" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">@Resources.Language.CustomerShip_SimpleName</label>
                                                    <div class="col-sm-8">
                                                        <input id="_CustomerShip_SimpleName" type="text" class="form-control" placeholder="@Resources.Language.CustomerShip_SimpleName" onfocus="$(this).parent().removeClass('has-error')" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">@Resources.Language.CustomerShip_DeadWeight</label>
                                                    <div class="col-sm-8">
                                                        <input id="_CustomerShip_DeadWeight" type="number" class="form-control" placeholder="@Resources.Language.CustomerShip_DeadWeight" onfocus="$(this).parent().removeClass('has-error')" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">*@Resources.Language.CustomerShip_Length</label>
                                                    <div class="col-sm-8">
                                                        <input id="_CustomerShip_Length" type="number" class="form-control" placeholder="@Resources.Language.CustomerShip_Length" onfocus="$(this).parent().removeClass('has-error')" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">@Resources.Language.CustomerShip_Width</label>
                                                    <div class="col-sm-8">
                                                        <input id="_CustomerShip_Width" type="number" class="form-control" placeholder="@Resources.Language.CustomerShip_Width" onfocus="$(this).parent().removeClass('has-error')" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">@Resources.Language.CustomerShip_TEUS</label>
                                                    <div class="col-sm-8">
                                                        <input id="_CustomerShip_TEUS" type="number" class="form-control" placeholder="@Resources.Language.CustomerShip_TEUS" onfocus="$(this).parent().removeClass('has-error')" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="form-group">
                                                    <label class="col-sm-4 control-label">@Resources.Language.CustomerShip_Class</label>
                                                    <div class="col-sm-8">
                                                        <input id="_CustomerShip_Class" type="text" class="form-control" placeholder="@Resources.Language.CustomerShip_Class" onfocus="$(this).parent().removeClass('has-error')" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">@Resources.Language.Remark</label>
                                                    <div class="col-sm-10">
                                                        <textarea id="_Remark" rows="3" class="form-control" placeholder="@Resources.Language.Remark" onfocus="$(this).parent().removeClass('has-error')"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                    <div id="parentErrMsg" class="alert alert-block alert-warning fade in" hidden>
                                        @*<a class="close" data-dismiss="alert" href="#" aria-hidden="true">&times;</a>*@
                                        <i class="fa fa-exclamation-circle"></i><p style=""></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">@Resources.Language.Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitParentModal()">@Resources.Language.Submit</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /Parent MODAL FORM-->
    <div class="container">
        <div class="row">
            <div id="content" class="col-lg-12">
                <!-- PAGE HEADER-->
                <div class="row">
                    <div class="col-sm-12">
                        <div class="">
                            <!-- STYLER -->
                            <!-- /STYLER -->
                            <!-- BREADCRUMBS -->
                            <ul class="breadcrumb">
                                <li>
                                    <i class="fa fa-home"></i>
                                    <a href="#">@Resources.Language.HomePage</a>
                                </li>
                                <li>
                                    <i class="fa fa-users"></i>
                                    <a href="#">物料</a>
                                </li>
                                <li>
                                    物料基本信息
                                </li>
                            </ul>
                            <!-- /BREADCRUMBS -->
                            @*<div class="clearfix">
                                    <h3 class="content-title pull-left">Grid Test</h3>
                                </div>
                                <div class="description">Table</div>*@
                            @*<button type="button" class="btn btn-danger" onclick="AddChild()">Add</button>*@
                        </div>
                    </div>
                </div>
                <!-- /PAGE HEADER -->
                <!-- SAMPLE -->
                <div class="row">
                    <div class="col-md-12">
                        <!-- BOX -->
                        <div class="box border orange">
                            <div class="box-title">
                                <h4><i class="fa fa-bars"></i>物料基本信息管理</h4>
                            </div>
                            <div id="jqGridContainerBox" class="box-body">
                                <div class="row">
                                    <!-- ORDER SCROLL -->
                                    <div class="col-md-3">
                                        <div class="panel panel-default">
                                            <div class="panel-body orders">
                                                <div @*class="scroller"*@ data-height="600px" data-always-visible="1" data-rail-visible="1">
                                                    <div class="padding-bottom-20">
                                                        <div class="input-group">
                                                            <input id="searchCustomer" type="text" class="form-control" placeholder="请输入客户名称" value="@ViewBag.QueryName" onkeypress="return onKeyPress(event)">
                                                            <span class="input-group-btn">
                                                                <button class="btn btn-danger" type="button" onclick="clearCustomer()">清除</button>
                                                                <button class="btn btn-primary" type="button" onclick="searchCustomer($('#searchCustomer').val())">搜索</button>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <ul class="list-unstyled">
                                                        @{
                                                            for (int i = 0; i < Model.Count; i++)
                                                            {
                                                                <li class="clearfix" onclick="loadCustomerShips($(this), '@Model[i].IDX', '@Model[i].Name1')">
                                                                    <div class="pull-left">
                                                                        @if (i % 2 == 0)
                                                                        {
                                                                            <p><h6><i class="fa fa-user"></i><strong> @Model[i].Name1</strong></h6></p>

                                                                        }
                                                                        else
                                                                        {
                                                                            <p><h6><i class="fa fa-user"></i><strong> @Model[i].Name1</strong></h6></p>
                                                                        }
                                                                    </div>
                                                                    <div class="clearfix"></div>
                                                                </li>
                                                            }
                                                        }
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class='text-center'>
                                                <ul class='pagination'>
                                                    @{
                                                        for (int i = 0; i < ViewBag.TotalPageNum; i++)
                                                        {
                                                            if (i + 1 == ViewBag.CurPage)
                                                            {
                                                                <li class='active'>
                                                                    @*<a href='@Url.Action("GetCustomers", "Customer", new { curPage = i + 1 })'>@(i + 1)</a>*@
                                                                    <a href='#' onclick='getCustomers("@i")'>@(i + 1)</a>
                                                                </li>
                                                            }
                                                            else
                                                            {
                                                                <li class=''>
                                                                    @*<a href='@Url.Action("GetCustomers", "Customer", new { curPage = i + 1 })'>@(i + 1)</a>*@
                                                                    <a href='#' onclick='getCustomers("@i")'>@(i + 1)</a>
                                                                </li>
                                                            }
                                                        }
                                                    }
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- /ORDER SCROLL -->
                                    <div id="" class="col-md-9">
                                        <div id="contact-card" class="panel panel-default">
                                            <div class="panel-heading">
                                                <h5 class="panel-title">
                                                    @{
                                                        if (Model.Count > 0)
                                                        {
                                                            <span hidden>@Model[0].IDX</span>
                                                            <span>@Model[0].Name1</span>
                                                        }
                                                        else
                                                        {
                                                            <span></span>
                                                            <span></span>
                                                        }
                                                    }
                                                </h5>
                                            </div>
                                            <div id="" class="panel-body">
                                                <table id="jqGrid"></table>
                                                <div id="jqGridPager"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /BOX -->
                    </div>
                </div>
                <!-- /SAMPLE -->
                <div class="footer-tools">
                    <span class="go-top">
                        <i class="fa fa-chevron-up"></i> Top
                    </span>
                </div>
            </div>
        </div>
    </div>
    </div>
    <script type="text/javascript">
    var tableConfig = null;

    $(document).ready(function () {

        if (tableConfig == null) {
            GetTableConfig();
        }


        $("#jqGrid").jqGrid({
            url: "/CustomerShip/GetCustomerShips" + '?ctmId=' + $('.panel-title span:first').html(),
            mtype: "GET",
            datatype: "json",
            colModel: tableConfig.columns,
            viewrecords: true,
            height: '100%',
            rowNum: 15,
            autowidth: true,
            editurl: "/CustomerShip/AddEdit" + '?ctmId=' + $('.panel-title span:first').html(),
            pager: "#jqGridPager",
            loadonce: true,
            rowList: ['15', '20', '30', '40', '50'],
            rownumbers: true,
            shrinkToFit: false,     //指定各列宽度
            sortable: true,          //列可移动
            colMenu: true,         //列菜单
        });

        $('#jqGrid').jqGrid('filterToolbar', { searchResult: true, searchOperators: true });

        $("#jqGrid").jqGrid('bindKeys');  //光标可以控制上下移动

        $('#contact-card').resize(function () {
            var width = $('#contact-card').width() - 30;
            $("#jqGrid").setGridWidth(width);
        });

        $('#jqGrid').navGrid('#jqGridPager', { edit: false, add: false, del: false, refresh: false, view: false, search: false })

            .navButtonAdd('#jqGridPager', {
                caption: "", title: '@Resources.Language.Refresh', buttonicon: "ui-icon-refresh",
                onClickButton: function () {
                    $('#jqGrid').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                }
            })
            .navButtonAdd('#jqGridPager', {
                caption: "", title: "'@Resources.Language.ClearSearchFilter'", buttonicon: "ui-icon-circle-minus",
                onClickButton: function () {
                    var grid = $('#jqGrid')[0];
                    grid.clearToolbar();
                    $('#jqGrid').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                }
            })
            .navSeparatorAdd("#jqGridPager", { sepclass: "ui-separator", sepcontent: '' })
            .navButtonAdd('#jqGridPager', {
                caption: "", title: '@Resources.Language.DeleteSelectedRows', buttonicon: "ui-icon-trash",
                onClickButton: function () {
                    var rowid = jQuery('#jqGrid').jqGrid('getGridParam', 'selrow');
                    var dr = jQuery("#jqGrid").jqGrid('getRowData', rowid);//得到该行的数据
                    if (rowid != null) {
                        if (confirm('@Resources.Language.SureDelete')) {
                            var d = new Date();
                            $.ajax(
                                {
                                    type: "post",
                                    url: '@Url.Action("Delete", "CustomerShip")',
                                    data: { 'oper': 'delete', 'data': dr },//"oper=delete&id=" + gr,
                                    dataType: 'json',
                                    success: function (result) {
                                        alert(result.message);
                                        //jQuery("#jqGrid").jqGrid('delRowData', rowid);
                                        $('#jqGrid').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                                    },
                                    error: function (result) {
                                        console.log(result)
                                        try {
                                            var json = $.parseJSON(result.responseText);
                                            alert(json.errorMessage);
                                        } catch (e) {
                                            alert(e.message);
                                        }
                                    }
                                }
                                    );
                        }
                    }
                    else {
                        alert('选中一行');
                    }
                },
                position: "last"
            })
            .navButtonAdd('#jqGridPager', {
                //id: 'jqGrid_ilrefresh',
                caption: "", title: '@Resources.Language.Add', buttonicon: "ui-icon-plus",
                onClickButton: AddParent
            });

        $('#jqGrid').inlineNav('#jqGridPager',
            {
                edit: true,
                add: false,
                del: true,
                cancel: true,
                editParams: {
                    keys: true,
                    successfunc: function (val) {
                        if (val.responseText != "") {
                            var ret = $.parseJSON(val.responseText);
                            alert(ret.message);
                            $(this).jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                        }
                    },
                    url: null, //'/api/values',
                    mtype: 'POST'
                },

                addParams: {
                    keys: true,
                    successfunc: function (val) {
                        alert("111");
                        if (val.responseText != "") {
                            var ret = $.parseJSON(val.responseText);
                            alert(ret.message);
                            $(this).jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                        }
                    },
                    errorfunc: function (rowid, xhr) {
                        alert(xhr.responseText);
                        $(this).jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                    }
                }
            });

        //最后调用，冻结列
        //$("#jqGrid").jqGrid("setFrozenColumns");
    });

    function GetTableConfig() {
        tableConfig = {
            columns: [
            {
                align: 'center', label: "IDX", index: "IDX", name: "IDX", width: 100, editable: true, edittype: "text",
                editrules: { required: false }, hidden: true,
            },
            {
                align: 'center', label: '@Resources.Language.CustomerShip_CustomerID', name: "CustomerID", width: 100, editable: true, edittype: "text",
                editrules: { required: false }, hidden: true,
            },
            {
                align: 'center', label: '@Resources.Language.CustomerShip_ShipTypeID', name: "ShipTypeID", width: 100, editable: true, edittype: "text",
                editrules: { required: false }, hidden: true,
            },
            {
                align: 'center', label: '@Resources.Language.CustomerShip_Name1', name: "Name1", width: 100, editable: true, edittype: "text",
                editrules: { required: true }, colmenu: false,
                hidden: false,
                coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: false, freeze: false },
                searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
            },
            {
                align: 'center', label: '@Resources.Language.CustomerShip_Name2', name: "Name2", width: 100, editable: true, edittype: "text",
                editrules: { required: false }, colmenu: false,
                hidden: false,
                coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: false, freeze: false },
                searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
            },
            {
                align: 'center', label: '@Resources.Language.CustomerShip_SimpleName', name: "SimpleName", width: 100, editable: true, edittype: "text",
                editrules: { required: false }, colmenu: false,
                hidden: false,
                coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: false, freeze: false },
                searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
            },

            {
                align: 'center', label: '@Resources.Language.CustomerShip_Length', name: "Length", width: 100, editable: true, edittype: "text",
                editrules: { required: false, integer: true },
                hidden: false,
                coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: false, freeze: false },
                searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
            },
            {
                align: 'center', label: '@Resources.Language.CustomerShip_Width', name: "Width", width: 100, editable: true, edittype: "text",
                editrules: { required: false, integer: true },
                hidden: false,
                coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: false, freeze: false },
                searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
            },
            {
                align: 'center', label: '@Resources.Language.CustomerShip_TEUS', name: "TEUS", width: 100, editable: true, edittype: "text",
                editrules: { required: false, integer: true },
                hidden: false,
                coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: false, freeze: false },
                searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
            },
            {
                align: 'center', label: '@Resources.Language.CustomerShip_DeadWeight', name: "DeadWeight", width: 100, editable: true, edittype: "text",
                editrules: { required: false, integer: true },
                hidden: false,
                coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: false, freeze: false },
                searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
            },
            {
                align: 'center', label: '@Resources.Language.CustomerShip_Class', name: "Class", width: 100, editable: true, edittype: "text",
                editrules: { required: false }, colmenu: false,
                hidden: false,
                coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: false, freeze: false },
                searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
            },
            {
                align: 'center', label: '@Resources.Language.Remark', name: "Remark", width: 150, editable: true, edittype: "textarea",
                editrules: { required: false }, colmenu: false,
                hidden: false,
                coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: false, freeze: false },
                searchoptions: { sopt: ["cn", "eq", "bw", "ew"] },
            },
            {
                align: 'center', label: '@Resources.Language.OwnerID', name: "OwnerID", width: 100, editable: true, edittype: "text",
                editrules: { required: false }, hidden: true,
                editoptions: {
                    defaultValue: -1
                }
            },
                {
                    align: 'center',
                    label: '@Resources.Language.CreateDate', name: "CreateDate", width: 100, editable: false, edittype: "text",
                    editrules: { required: false, date: true }, hidden: false,
                    colmenu: false, coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: false, freeze: false },
                    editoptions: {
                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d H:i:s',
                                step: 1,
                            });
                        },
                        defaultValue: new Date().Format("yyyy-MM-dd hh:mm:ss")
                    },

                    searchoptions: {
                        sopt: ["lt", "ge"],
                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d H:i:s',
                                step: 1,
                                //timepicker: false
                            });
                        }
                    }
                },
                {
                    align: 'center', label: '@Resources.Language.UserID', name: "UserID", width: 100, editable: true, edittype: "text",
                    editrules: { required: false }, hidden: true
                },
            {
                align: 'center',
                label: '@Resources.Language.LastUpDate', name: "LastUpDate", width: 100, editable: false, edittype: "text",
                editrules: { required: false, date: true }, hidden: false,
                colmenu: false, coloptions: { sorting: false, columns: false, filtering: false, seraching: false, grouping: false, freeze: false },
                editoptions: {
                    dataInit: function (element) {
                        $(element).datetimepicker({
                            format: 'Y-m-d H:i:s',
                            step: 1,
                        });
                    },
                    defaultValue: new Date().Format("yyyy-MM-dd hh:mm:ss")
                },

                searchoptions: {
                    sopt: ["lt", "ge"],
                    dataInit: function (element) {
                        $(element).datetimepicker({
                            format: 'Y-m-d H:i:s',
                            step: 1,
                            //timepicker: false
                        });
                    }
                }
            },
            {
                align: 'center', label: '@Resources.Language.UserDefinedCol1', name: "UserDefinedCol1", width: 100, editable: true, edittype: "text",
                editrules: { required: false }, hidden: true
            },
            {
                align: 'center', label: '@Resources.Language.UserDefinedCol2', name: "UserDefinedCol2", width: 100, editable: true, edittype: "text",
                editrules: { required: false }, hidden: true
            },
            {
                align: 'center', label: '@Resources.Language.UserDefinedCol3', name: "UserDefinedCol3", width: 100, editable: true, edittype: "text",
                editrules: { required: false }, hidden: true
            },
            {
                align: 'center', label: '@Resources.Language.UserDefinedCol4', name: "UserDefinedCol4", width: 100, editable: true, edittype: "text",
                editrules: { required: false }, hidden: true
            },
            {
                align: 'center', label: '@Resources.Language.UserDefinedCol5', name: "UserDefinedCol5", width: 100, editable: true, edittype: "text",
                editrules: { required: false, number: true }, hidden: true
            },
            {
                align: 'center', label: '@Resources.Language.UserDefinedCol6', name: "UserDefinedCol6", width: 100, editable: true, edittype: "text",
                editrules: { required: false, integer: true }, hidden: true
            },
            {
                align: 'center', label: '@Resources.Language.UserDefinedCol7', name: "UserDefinedCol7", width: 100, editable: true, edittype: "text",
                editrules: { required: false, integer: true }, hidden: true
            },
            {
                align: 'center', label: '@Resources.Language.UserDefinedCol8', name: "UserDefinedCol8", width: 100, editable: true, edittype: "text",
                editrules: { required: false, integer: true }, hidden: true
            },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol9', name: "UserDefinedCol9", width: 100, editable: true, edittype: "text",
                    editrules: { required: false, date: true }, hidden: true,
                    datefmt: 'yyyy-mm-dd',
                    sorttype: 'date',
                    editoptions: {
                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d H:i:s',
                                step: 1,
                            });
                        },
                        defaultValue: new Date().Format("yyyy-MM-dd hh:mm:ss")
                    },

                    searchoptions: {
                        sopt: ["lt", "ge"],
                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d H:i:s',
                                step: 1,
                                //timepicker: false
                            });
                        }
                    }
                },
                {
                    align: 'center', label: '@Resources.Language.UserDefinedCol10', name: "UserDefinedCol10", width: 100, editable: true, edittype: "text",
                    editrules: { required: false, date: true }, hidden: true,
                    datefmt: 'yyyy-mm-dd',
                    sorttype: 'date',
                    editoptions: {
                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d H:i:s',
                                step: 1,
                            });
                        },
                        defaultValue: new Date().Format("yyyy-MM-dd hh:mm:ss")
                    },

                    searchoptions: {
                        sopt: ["lt", "ge"],
                        dataInit: function (element) {
                            $(element).datetimepicker({
                                format: 'Y-m-d H:i:s',
                                step: 1,
                                //timepicker: false
                            });
                        }
                    }
                },

            ]
        };
    }

    function loadCustomerShips(self, customer_id, customer_Name1) {
        $('.panel-title span:first').html(customer_id);
        $('.panel-title span:last').html(customer_Name1);

        $('li.clearfix').removeAttr('style');
        $(self).css('background-color', 'ButtonHighlight');

        //alert(customer_id);
        $('#jqGrid').jqGrid('setGridParam',
            {
                datatype: 'json',
                url: '@Url.Action("GetCustomerShips", "CustomerShip")' + '?ctmId=' + $('.panel-title span:first').html(),
            }).trigger('reloadGrid');

        $("#jqGrid").jqGrid('setGridParam', { editurl: '@Url.Action("AddEdit", "CustomerShip")' + '?ctmId=' + customer_id });
    }

    function searchCustomer(text) {

        var curPage = 1;
        var queryName = text.trim();

        $.ajax(
            {
                type: "get",
                url: "/CustomerShip/GetCustomers",
                dataType: 'html',
                type: 'get',
                data: { 'curPage': curPage, 'queryName': queryName },
                success: function (result) {
                    $("body").html(result);
                },
            }
            );
    }

    function clearCustomer() {
        $('#searchCustomer').val("");
        var curPage = 1;
        $.ajax(
            {
                type: "get",
                url: '@Url.Action("GetCustomers", "CustomerShip")',
                dataType: 'html',
                type: 'get',
                data: { 'curPage': curPage, 'queryName': "" },
                success: function (result) {
                    $("body").html(result);
                },
            }
            );

    }
    function onKeyPress(e) {
        var keyCode = null;

        if (e.which)
            keyCode = e.which;
        else if (e.keyCode)
            keyCode = e.keyCode;

        if (keyCode == 13) {
            searchCustomer($('#searchCustomer').val());
            return false;
        }
        return true;
    }
    function getCustomers(pageIndex) {
        var curPage = parseInt(pageIndex) + 1;
        var queryName = $('#searchCustomer').val().trim();

        $.ajax(
            {
                type: "get",
                url: '@Url.Action("GetCustomers", "CustomerShip")',
                dataType: 'html',
                type: 'get',
                data: { 'curPage': curPage, 'queryName': queryName },
                success: function (result) {
                    $("body").html(result);
                },
            }
            );
    }

    //模态框
    function AddParent() {
        $('#parent-modal').modal()
    }
    function initParentModal() {
        $('#parentErrMsg').hide();
        $('#_CustomerShip_Name1').parent().removeClass("has-error");
        $('#_CustomerShip_Name2').parent().removeClass("has-error");
        $('#_CustomerShip_SimpleName').parent().removeClass("has-error");
        $('#_CustomerShip_DeadWeight').parent().removeClass("has-error");
        $('#_CustomerShip_Length').parent().removeClass("has-error");
        $('#_CustomerShip_Width').parent().removeClass("has-error");
        $('#_CustomerShip_TEUS').parent().removeClass("has-error");
        $('#_CustomerShip_Class').parent().removeClass("has-error");
        $('#_Remark').parent().removeClass("has-error");

        $('#_CustomerShip_Name1').val("");
        $('#_CustomerShip_Name2').val("");
        $('#_CustomerShip_SimpleName').val("");
        $('#_CustomerShip_DeadWeight').val("");
        $('#_CustomerShip_Length').val("");
        $('#_CustomerShip_Width').val("");
        $('#_CustomerShip_TEUS').val("");
        $('#_CustomerShip_Class').val("");
        $('#_Remark').val("");
    }

    $('#parent-modal').on('show.bs.modal', function (e) {
        initParentModal();
    });
    $('#parent-modal').on('shown.bs.modal', function (e) {
    });
    $('#parent-modal').on('hide.bs.modal', function () {
        $(this).removeData("bs.modal");
        //alert("hide");
    });
    $('#parent-modal').on('hidden.bs.modal', function () {
        $(this).removeData("bs.modal");
        //alert("hidden");
    });

    function submitParentModal() {
        var maxTextLength = 25;
        var maxTextAreaLength = 500;

        $('#parentErrMsg').hide();
        $('#_CustomerShip_Name1').parent().removeClass("has-error");
        $('#_CustomerShip_Name2').parent().removeClass("has-error");
        $('#_CustomerShip_SimpleName').parent().removeClass("has-error");
        $('#_CustomerShip_DeadWeight').parent().removeClass("has-error");
        $('#_CustomerShip_Length').parent().removeClass("has-error");
        $('#_CustomerShip_Width').parent().removeClass("has-error");
        $('#_CustomerShip_TEUS').parent().removeClass("has-error");
        $('#_CustomerShip_Class').parent().removeClass("has-error");
        $('#_Remark').parent().removeClass("has-error");

        var CustomerShip_Name1 = $('#_CustomerShip_Name1').val();
        var CustomerShip_Name2 = $('#_CustomerShip_Name2').val();
        var CustomerShip_SimpleName = $('#_CustomerShip_SimpleName').val();
        var CustomerShip_DeadWeight = $('#_CustomerShip_DeadWeight').val();
        var CustomerShip_Length = $('#_CustomerShip_Length').val();
        var CustomerShip_Width = $('#_CustomerShip_Width').val();
        var CustomerShip_TEUS = $('#_CustomerShip_TEUS').val();
        var CustomerShip_Class = $('#_CustomerShip_Class').val();
        var Remark = $('#_Remark').val();

        if (CustomerShip_Name1.length <= 0) {
            $('#parentErrMsg p').html('@Resources.Language.CustomerShip_Name1' + "@Resources.Language.IsNull");
            $('#_CustomerShip_Name1').parent().addClass("has-error");
            $('#parentErrMsg').show();
            return;
        }
        if (CustomerShip_Length.length <= 0) {
            $('#parentErrMsg p').html('@Resources.Language.CustomerShip_Length' + "@Resources.Language.IsNull");
            $('#_CustomerShip_Length').parent().addClass("has-error");
            $('#parentErrMsg').show();
            return;
        }
        //提交数据库
        $.ajax({
            type: "post",
            url: '@Url.Action("AddCustomerShip", "CustomerShip")',
            data: {
                    'ctmId': $('.panel-title span:first').html(),
                    'Name1': CustomerShip_Name1,
                    'Name2': CustomerShip_Name2,
                    'SimpleName': CustomerShip_SimpleName,
                    'DeadWeight': CustomerShip_DeadWeight,
                    'Length': CustomerShip_Length,
                    'Width': CustomerShip_Width,
                    'TEUS': CustomerShip_TEUS,
                    'Class': CustomerShip_Class,
                    'Remark': Remark
                },//"oper=delete&id=" + gr,
                dataType: 'json',
                success: function (result) {

                    $('#parent-modal').modal('hide')
                    //jQuery("#jqGrid").jqGrid('delRowData', rowid);
                    //$('#jqGrid').jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');
                    alert(result.message);

                    $('#jqGrid').jqGrid('setGridParam',
                    {
                        datatype: 'json',
                        url: "/CustomerShip/GetCustomerShips" + '?ctmId=' + $('.panel-title span:first').html(),
                    }).trigger('reloadGrid');

                    $("#jqGrid").jqGrid('setGridParam', { editurl: "/CustomerShip/AddEdit" + '?ctmId=' + $('.panel-title span:first').html() });

                },
                error: function (result) {
                    console.log(result)
                    try {
                        var json = $.parseJSON(result.responseText);
                        alert(json.errorMessage);
                    } catch (e) {
                        alert(e.message);
                    }
                    return;
                }
        });

    }
</script>
